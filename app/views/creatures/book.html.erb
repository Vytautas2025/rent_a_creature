<div class="container my-4">
  <h1>Book <%= @creature.name %></h1>

  <div class="row">
    <div class="col-md-6 card mb-4 card-body">

      <%= image_tag cl_image_path(@creature.photo.key), class: "img-fluid mb-3" if @creature.photo.attached? %>

      <h5 class="card-title"><%= @creature.name %></h5>
      <p class="card-text"><%= @creature.description %></p>
      <p class="card-text"><strong>Price:</strong> $<%= @creature.price %> per day</p>
    </div>

    <div class="col-md-6">
      <div class="card card-body">
        <h5 class="card-title">Book this creature</h5>

        <!-- Store the price data in a hidden element -->
        <div data-price-per-day="<%= @creature.price %>" class="d-none"></div>

        <%= simple_form_for @booking, url: create_booking_creature_path(@creature), method: :post do |f| %>
          <% if @booking.errors.any? %>
            <div class="alert alert-danger mb-3">
              <h6><%= pluralize(@booking.errors.count, "error") %> prohibited this booking from being saved:</h6>
              <ul class="mb-0">
                <% @booking.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <% booked_dates_json = @existing_bookings.map { |b| {start: b.start_date, end: b.end_date} }.to_json %>

          <!-- Date picker with Stimulus controller -->
          <div data-controller="datepicker" data-datepicker-booked-dates-value='<%= booked_dates_json %>'>
            <div class="mb-3">
              <label class="form-label">Select dates</label>
              <input type="text"
                     class="form-control"
                     placeholder="Click to select dates"
                     autocomplete="off"
                     readonly>
              <small class="form-text text-muted">Unavailable dates will be grayed out in the calendar.</small>

              <!-- Hidden fields updated by our controller -->
              <%= f.hidden_field :start_date, data: { datepicker_target: "startDate" } %>
              <%= f.hidden_field :end_date, data: { datepicker_target: "endDate" } %>
            </div>
          </div>

          <div class="mb-3">
            <p class="mb-1"><strong>Booking Total:</strong></p>
            <p data-booking-total>Select dates to see the total price</p>
          </div>

          <%= f.button :submit, "Request Booking", class: "btn btn-primary w-100" %>
        <% end %>
      </div>
    </div>

    <div class="mt-3">
      <%= link_to "Back to Creature", creature_path(@creature), class: "btn btn-secondary" %>
    </div>
  </div>
</div>
